//
//  PersonalCenterView.m
//  XiaoHuaiDan
//
//  Created by WongSuwy on 2014/6/28.
//  Copyright (c) 2014年 sch. All rights reserved.
//

#import "PersonalCenterView.h"
#import "GetUserInfo.h"
#import "PetViewController.h"
#import "DeletePet.h"
#import "UIImageView+WebCache.h"

@implementation PersonalCenterView
@synthesize sv,userInfoDic,petsArr;

-(void)drawRect:(CGRect)rect
{
    CGRect frame = rect;
    
    GetUserInfo *gui = [[GetUserInfo alloc] init];
    gui.userDataDic = [NSMutableDictionary dictionaryWithCapacity:0];
    [gui getUserInfo:0];
    
    self.userInfoDic = [NSMutableDictionary dictionaryWithDictionary:gui.userDataDic];
    NSLog(@"===========userInfoDic==========:%@",self.userInfoDic);
    
    self.petsArr = [NSMutableArray arrayWithArray:[self.userInfoDic objectForKey:@"pets"]];
    
    [gui release];
    
    [self setBackgroundColor:[UIColor whiteColor]];
    
    UIView *barView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, frame.size.width, 128.0/1136.0*frame.size.height)];
    [barView setBackgroundColor:[UIColor colorWithRed:255.0/255.0 green:83.0/255.0 blue:99.0/255.0 alpha:1.0]];
    [self addSubview:barView];
    
    UITextField *titleText = [[UITextField alloc] initWithFrame:CGRectMake(224.0/640.0*frame.size.width, 65.0/1136.0*frame.size.height, 180.0/640.0*frame.size.width, 39.0/1136.0*frame.size.height)];
    titleText.text = @"个人中心";
    titleText.textColor = [UIColor whiteColor];
    [titleText setFont:[UIFont fontWithName:@"Arial" size:17.0]];
    titleText.textAlignment = NSTextAlignmentCenter;
    [titleText setEnabled:NO];
    [barView addSubview:titleText];
    
    [barView release];
    [titleText release];
    
    UIImageView *background = [[UIImageView alloc] initWithFrame:CGRectMake( 0.0/640.0*frame.size.width, 128.0/1136.0*frame.size.height, 640.0/640.0*frame.size.width, 540.0/1136.0*frame.size.height)];
    [background setImage:[UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:[self.userInfoDic objectForKey:@"backdrop"]]]]];
    [background setUserInteractionEnabled:YES];
    [self addSubview:background];
    
    UIImageView *headImg = [[UIImageView alloc] initWithFrame:CGRectMake( 224.0/640.0*frame.size.width, 165.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 180.0/640.0*frame.size.width, 180.0/1136.0*frame.size.height)];
    headImg.layer.cornerRadius = headImg.bounds.size.width/2;
    [headImg.layer setBorderWidth:2];
    [headImg.layer setBorderColor:[[UIColor whiteColor] CGColor]];
    headImg.layer.masksToBounds = YES;
//    [headImg setImage:[UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:[self.userInfoDic objectForKey:@"portrait"]]]]];
    [headImg sd_setImageWithURL:[NSURL URLWithString:[self.userInfoDic objectForKey:@"portrait"]] placeholderImage:[UIImage imageNamed:@"wait.png"]];
    [background addSubview:headImg];
    
    UITextField *nameText = [[UITextField alloc] initWithFrame:CGRectMake(274.0/640.0*frame.size.width, 364.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 93.0/640.0*frame.size.width, 35.0/1136.0*frame.size.height)];
    nameText.text = [self.userInfoDic objectForKey:@"name"];
    nameText.textColor = [UIColor colorWithRed:118.0/255.0 green:196.0/255.0 blue:255.0/255.0 alpha:1.0];
    [nameText setFont:[UIFont fontWithName:@"Arial" size:24.0]];
    [nameText setEnabled:NO];
    [background addSubview:nameText];
    
    UIImageView *sexImg = [[UIImageView alloc] initWithFrame:CGRectMake( 225.0/640.0*frame.size.width, 407.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 18.0/640.0*frame.size.width, 24.0/1136.0*frame.size.height)];
    [sexImg setImage:[UIImage imageNamed:@"girl_02.png"]];
    [background addSubview:sexImg];
    
    UILabel *sexLbl = [[UILabel alloc] initWithFrame:CGRectMake( 245.0/640.0*frame.size.width, 407.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 74.0/640.0*frame.size.width, 24.0/1136.0*frame.size.height)];
    if ([[self.userInfoDic objectForKey:@"sex"] isEqualToString:@"0"]) {
        sexLbl.text = @"妹子";
    }else{
        sexLbl.text = @"帅哥";
    }
    
    sexLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
    sexLbl.textColor = [UIColor whiteColor];
    [background addSubview:sexLbl];
    
    UIImageView *locImg = [[UIImageView alloc] initWithFrame:CGRectMake( 334.0/640.0*frame.size.width, 406.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 22.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height)];
    [locImg setImage:[UIImage imageNamed:@"pin.png"]];
    [background addSubview:locImg];
    
    UILabel *locLbl = [[UILabel alloc] initWithFrame:CGRectMake( 358.0/640.0*frame.size.width, 407.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 74.0/640.0*frame.size.width, 24.0/1136.0*frame.size.height)];
    locLbl.text = [self.userInfoDic objectForKey:@"region"];
    locLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
    locLbl.textColor = [UIColor whiteColor];
    [background addSubview:locLbl];
    
    [headImg release];
    [nameText release];
    [sexImg release];
    [sexLbl release];
    [locImg release];
    [locLbl release];
    
    self.sv = [[UIScrollView alloc] initWithFrame:CGRectMake( 0.0/640.0*frame.size.width, 452.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, frame.size.width, 188.0/1136.0*frame.size.height)];
    sv.delegate = self;
    sv.showsHorizontalScrollIndicator = NO;
    sv.contentSize = CGSizeMake(364.0/640.0*frame.size.width*[[self.userInfoDic objectForKey:@"pets"] count]+114.0/640.0*self.frame.size.width, 170.0/1136.0*frame.size.height);
    sv.tag = 10;
    sv.pagingEnabled = NO;
    sv.bounces = NO;
    [sv setUserInteractionEnabled:YES];
    //        sv.contentOffset = CGPointMake(344.0/640.0*frame.size.width, 0);
    //        [sv setBackgroundColor:[UIColor whiteColor]];
    [background addSubview:sv];
    
    UILongPressGestureRecognizer *longPressGestureRecognizer = [[UILongPressGestureRecognizer alloc]
                                                                initWithTarget:self
                                                                action:@selector(handleLongPressGestures:)];
    /* numberOfTouchesRequired这个属性保存了有多少个手指点击了屏幕,因此你要确保你每次的点击手指数目是一样的,默认值是为 0. */
    longPressGestureRecognizer.numberOfTouchesRequired = 1;
    /* Maximum 100 pixels of movement allowed before the gesture is recognized */
    /*最大100像素的运动是手势识别所允许的*/
    longPressGestureRecognizer.allowableMovement = 0.0f;
    /*这个参数表示,两次点击之间间隔的时间长度。*/
    longPressGestureRecognizer.minimumPressDuration = 1.0;
    [self.sv addGestureRecognizer:longPressGestureRecognizer];
    
    UITapGestureRecognizer* singleTapRecognizer;
    singleTapRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTap:)];
    singleTapRecognizer.numberOfTapsRequired = 1; // 单击
    [self.sv addGestureRecognizer:singleTapRecognizer];
    
    for (int i = 0; i <= [[self.userInfoDic objectForKey:@"pets"] count]+1; i++) {
        
        if (i < [self.petsArr count]) {
            
            UIImageView *petInfoImg = [[UIImageView alloc] initWithFrame:CGRectMake(364.0/640.0*frame.size.width*i, 18.0/1136.0*frame.size.height, 344.0/640.0*frame.size.width, 170.0/1136.0*frame.size.height)];
            [petInfoImg setImage:[UIImage imageNamed:@"stamp_type.png"]];
            [petInfoImg setUserInteractionEnabled:YES];
            petInfoImg.tag = i;
            [self.sv addSubview:petInfoImg];
            
            UIButton *deleteBtn = [UIButton buttonWithType:UIButtonTypeSystem];
            deleteBtn.frame = CGRectMake(0.0/640.0*self.frame.size.width, 0, 36.0/640.0*self.frame.size.width, 36.0/1136.0*self.frame.size.height);
            [deleteBtn setBackgroundImage:[UIImage imageNamed:@"delelte_icon.png"] forState:UIControlStateNormal];
            [deleteBtn addTarget:self action:@selector(deletePet:) forControlEvents:UIControlEventTouchUpInside];
            [deleteBtn setHidden:YES];
            deleteBtn.tag = 20 + i ;
            [petInfoImg addSubview:deleteBtn];
            
            UIButton *editBtn = [UIButton buttonWithType:UIButtonTypeSystem];
            editBtn.frame = CGRectMake(281.0/640.0*self.frame.size.width, 21.0/1136.0*self.frame.size.height, 32.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height);
            [editBtn setBackgroundImage:[UIImage imageNamed:@"write.png"] forState:UIControlStateNormal];
            [editBtn addTarget:self action:@selector(editPet:) forControlEvents:UIControlEventTouchUpInside];
            editBtn.tag = 90 + i ;
            [petInfoImg addSubview:editBtn];
            
            UIImageView *petImg = [[UIImageView alloc] initWithFrame:CGRectMake( 32.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height,116.0/640.0*frame.size.width, 116.0/1136.0*frame.size.height)];
//            [petImg setImage:[UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:[[self.petsArr objectAtIndex:i] objectForKey:@"portrait"]]]]];
            
            NSURL *url = [NSURL URLWithString:[[self.petsArr objectAtIndex:i] objectForKey:@"portrait"]];
            
            [petImg sd_setImageWithURL:url placeholderImage:[UIImage imageNamed:@"wait.png"]];
            petImg.layer.cornerRadius = petImg.bounds.size.width/2;
            [petImg.layer setBorderWidth:2];
            [petImg.layer setBorderColor:[[UIColor grayColor] CGColor]];
            petImg.layer.masksToBounds = YES;
            [petInfoImg addSubview:petImg];
            
            UILabel *pNameLbl = [[UILabel alloc] initWithFrame:CGRectMake( 157.0/640.0*frame.size.width, 37.0/1136.0*frame.size.height, 60.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height)];
            pNameLbl.text = [[self.petsArr objectAtIndex:i] objectForKey:@"name"];
            pNameLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
            pNameLbl.textColor = [UIColor colorWithRed:118.0/255.0 green:196.0/255.0 blue:255.0/255.0 alpha:1.0];
            [petInfoImg addSubview:pNameLbl];
            
            UILabel *pVarietiesLbl = [[UILabel alloc] initWithFrame:CGRectMake( 160.0/640.0*frame.size.width, 77.0/1136.0*frame.size.height, 48.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height)];
            pVarietiesLbl.text = [[self.petsArr objectAtIndex:i] objectForKey:@"breed"];
            pVarietiesLbl.font = [UIFont fontWithName:@"Arial" size:12.0];
            pVarietiesLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
            [petInfoImg addSubview:pVarietiesLbl];
            
            UILabel *birthLbl = [[UILabel alloc] initWithFrame:CGRectMake( 158.0/640.0*frame.size.width, 111.0/1136.0*frame.size.height, 120.0/640.0*frame.size.width, 20.0/1136.0*frame.size.height)];
            birthLbl.text = [[self.petsArr objectAtIndex:i] objectForKey:@"birthday"];
            birthLbl.font = [UIFont fontWithName:@"Arial" size:12.0];
            birthLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
            [petInfoImg addSubview:birthLbl];
            
            UIImageView *postImg = [[UIImageView alloc] initWithFrame:CGRectMake( 252.0/640.0*frame.size.width, 98.0/1136.0*frame.size.height, 94.0/640.0*frame.size.width, 66.0/1136.0*frame.size.height)];
            [postImg setImage:[UIImage imageNamed:@"postmark.png"]];
            [petInfoImg addSubview:postImg];
            
            [petInfoImg release];
            [petImg release];
            [pNameLbl release];
            [pVarietiesLbl release];
            [birthLbl release];
            [postImg release];
            
        }else if (i == [[self.userInfoDic objectForKey:@"pets"] count]+1){
            
            UIButton *addBtn = [UIButton buttonWithType:UIButtonTypeSystem];
            addBtn.frame = CGRectMake(364.0/640.0*self.frame.size.width*[self.petsArr count], 78.0/1136.0*self.frame.size.height, 54.0/640.0*self.frame.size.width,54.0/1136.0*self.frame.size.height);
            [addBtn setBackgroundImage:[UIImage imageNamed:@"add.png"] forState:UIControlStateNormal];
            [addBtn addTarget:self action:@selector(addPet:) forControlEvents:UIControlEventTouchUpInside];
            addBtn.tag = 20 + i ;
            [self.sv addSubview:addBtn];
            
        }
        
    }
    
    [background release];
    
    UITableView *table = [[UITableView alloc] initWithFrame:CGRectMake(0, 668.0/1136.0*frame.size.height, frame.size.width, frame.size.height-668.0/1136.0*frame.size.height) style:UITableViewStylePlain];//-90.0/1136.0*self.frame.size.height
    table.dataSource = self;
    table.delegate = self;
    table.bounces = NO;
    //        table.separatorStyle = UITableViewCellSeparatorStyleNone;
    [self addSubview:table];
    
    [table release];

}

-(void)refrshUserCentrer:(NSMutableDictionary *)value
{
    [self setNeedsDisplay];
}

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
        
//        GetUserInfo *gui = [[GetUserInfo alloc] init];
//        gui.userDataDic = [NSMutableDictionary dictionaryWithCapacity:0];
//        [gui getUserInfo:0];
//
//        self.userInfoDic = [NSMutableDictionary dictionaryWithDictionary:gui.userDataDic];
//        NSLog(@"===========userInfoDic==========:%@",self.userInfoDic);
//
//        self.petsArr = [NSMutableArray arrayWithArray:[self.userInfoDic objectForKey:@"pets"]];
//
//        [gui release];
//
//        [self setBackgroundColor:[UIColor whiteColor]];
//        
//        UIView *barView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, frame.size.width, 128.0/1136.0*frame.size.height)];
//        [barView setBackgroundColor:[UIColor colorWithRed:255.0/255.0 green:83.0/255.0 blue:99.0/255.0 alpha:1.0]];
//        [self addSubview:barView];
//        
//        UITextField *titleText = [[UITextField alloc] initWithFrame:CGRectMake(224.0/640.0*frame.size.width, 65.0/1136.0*frame.size.height, 180.0/640.0*frame.size.width, 39.0/1136.0*frame.size.height)];
//        titleText.text = @"个人中心";
//        titleText.textColor = [UIColor whiteColor];
//        [titleText setFont:[UIFont fontWithName:@"Arial" size:17.0]];
//        titleText.textAlignment = NSTextAlignmentCenter;
//        [titleText setEnabled:NO];
//        [barView addSubview:titleText];
//
//        [barView release];
//        [titleText release];
//        
//        UIImageView *background = [[UIImageView alloc] initWithFrame:CGRectMake( 0.0/640.0*frame.size.width, 128.0/1136.0*frame.size.height, 640.0/640.0*frame.size.width, 540.0/1136.0*frame.size.height)];
//        [background setImage:[UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:[self.userInfoDic objectForKey:@"backdrop"]]]]];
//        [background setUserInteractionEnabled:YES];
//        [self addSubview:background];
//        
//        UIImageView *headImg = [[UIImageView alloc] initWithFrame:CGRectMake( 224.0/640.0*frame.size.width, 165.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 180.0/640.0*frame.size.width, 180.0/1136.0*frame.size.height)];
//        headImg.layer.cornerRadius = headImg.bounds.size.width/2;
//        [headImg.layer setBorderWidth:2];
//        [headImg.layer setBorderColor:[[UIColor whiteColor] CGColor]];
//        headImg.layer.masksToBounds = YES;
//        [headImg setImage:[UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:[self.userInfoDic objectForKey:@"portrait"]]]]];
//        [background addSubview:headImg];
//        
//        UITextField *nameText = [[UITextField alloc] initWithFrame:CGRectMake(274.0/640.0*frame.size.width, 364.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 93.0/640.0*frame.size.width, 35.0/1136.0*frame.size.height)];
//        nameText.text = [self.userInfoDic objectForKey:@"name"];
//        nameText.textColor = [UIColor colorWithRed:118.0/255.0 green:196.0/255.0 blue:255.0/255.0 alpha:1.0];
//        [nameText setFont:[UIFont fontWithName:@"Arial" size:24.0]];
//        [nameText setEnabled:NO];
//        [background addSubview:nameText];
//        
//        UIImageView *sexImg = [[UIImageView alloc] initWithFrame:CGRectMake( 225.0/640.0*frame.size.width, 407.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 18.0/640.0*frame.size.width, 24.0/1136.0*frame.size.height)];
//        [sexImg setImage:[UIImage imageNamed:@"girl_02.png"]];
//        [background addSubview:sexImg];
//        
//        UILabel *sexLbl = [[UILabel alloc] initWithFrame:CGRectMake( 245.0/640.0*frame.size.width, 407.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 74.0/640.0*frame.size.width, 24.0/1136.0*frame.size.height)];
//        if ([[self.userInfoDic objectForKey:@"sex"] isEqualToString:@"0"]) {
//            sexLbl.text = @"妹子";
//        }else{
//            sexLbl.text = @"帅哥";
//        }
//        
//        sexLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
//        sexLbl.textColor = [UIColor whiteColor];
//        [background addSubview:sexLbl];
//        
//        UIImageView *locImg = [[UIImageView alloc] initWithFrame:CGRectMake( 334.0/640.0*frame.size.width, 406.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 22.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height)];
//        [locImg setImage:[UIImage imageNamed:@"pin.png"]];
//        [background addSubview:locImg];
//        
//        UILabel *locLbl = [[UILabel alloc] initWithFrame:CGRectMake( 358.0/640.0*frame.size.width, 407.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, 74.0/640.0*frame.size.width, 24.0/1136.0*frame.size.height)];
//        locLbl.text = @"深圳";
//        locLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
//        locLbl.textColor = [UIColor whiteColor];
//        [background addSubview:locLbl];
//        
//        [headImg release];
//        [nameText release];
//        [sexImg release];
//        [sexLbl release];
//        [locImg release];
//        [locLbl release];
//        
//        self.sv = [[UIScrollView alloc] initWithFrame:CGRectMake( 0.0/640.0*frame.size.width, 452.0/1136.0*frame.size.height-128.0/1136.0*frame.size.height, frame.size.width, 188.0/1136.0*frame.size.height)];
//        sv.delegate = self;
//        sv.showsHorizontalScrollIndicator = NO;
//        sv.contentSize = CGSizeMake(364.0/640.0*frame.size.width*[[self.userInfoDic objectForKey:@"pets"] count]+114.0/640.0*self.frame.size.width, 170.0/1136.0*frame.size.height);
//        sv.tag = 10;
//        sv.pagingEnabled = NO;
//        sv.bounces = NO;
//        [sv setUserInteractionEnabled:YES];
////        sv.contentOffset = CGPointMake(344.0/640.0*frame.size.width, 0);
////        [sv setBackgroundColor:[UIColor whiteColor]];
//        [background addSubview:sv];
//        
//        UILongPressGestureRecognizer *longPressGestureRecognizer = [[UILongPressGestureRecognizer alloc]
//                                           initWithTarget:self
//                                           action:@selector(handleLongPressGestures:)];
//        /* numberOfTouchesRequired这个属性保存了有多少个手指点击了屏幕,因此你要确保你每次的点击手指数目是一样的,默认值是为 0. */
//        longPressGestureRecognizer.numberOfTouchesRequired = 1;
//        /* Maximum 100 pixels of movement allowed before the gesture is recognized */
//        /*最大100像素的运动是手势识别所允许的*/
//        longPressGestureRecognizer.allowableMovement = 0.0f;
//        /*这个参数表示,两次点击之间间隔的时间长度。*/
//        longPressGestureRecognizer.minimumPressDuration = 1.0;
//        [self.sv addGestureRecognizer:longPressGestureRecognizer];
//        
//        UITapGestureRecognizer* singleTapRecognizer;
//        singleTapRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTap:)];
//        singleTapRecognizer.numberOfTapsRequired = 1; // 单击
//        [self.sv addGestureRecognizer:singleTapRecognizer];
//        
//        for (int i = 0; i <= [[self.userInfoDic objectForKey:@"pets"] count]+1; i++) {
//            
//            if (i < [self.petsArr count]) {
//
//                UIImageView *petInfoImg = [[UIImageView alloc] initWithFrame:CGRectMake(364.0/640.0*frame.size.width*i, 18.0/1136.0*frame.size.height, 344.0/640.0*frame.size.width, 170.0/1136.0*frame.size.height)];
//                [petInfoImg setImage:[UIImage imageNamed:@"stamp_type.png"]];
//                [petInfoImg setUserInteractionEnabled:YES];
//                [self.sv addSubview:petInfoImg];
//                
//                UIButton *deleteBtn = [UIButton buttonWithType:UIButtonTypeSystem];
//                deleteBtn.frame = CGRectMake(0.0/640.0*self.frame.size.width, 0, 36.0/640.0*self.frame.size.width, 36.0/1136.0*self.frame.size.height);
//                [deleteBtn setBackgroundImage:[UIImage imageNamed:@"delelte_icon.png"] forState:UIControlStateNormal];
//                [deleteBtn addTarget:self action:@selector(deletePet:) forControlEvents:UIControlEventTouchUpInside];
//                [deleteBtn setHidden:YES];
//                deleteBtn.tag = 20 + i ;
//                [petInfoImg addSubview:deleteBtn];
//                
//                UIButton *editBtn = [UIButton buttonWithType:UIButtonTypeSystem];
//                editBtn.frame = CGRectMake(281.0/640.0*self.frame.size.width, 21.0/1136.0*self.frame.size.height, 32.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height);
//                [editBtn setBackgroundImage:[UIImage imageNamed:@"write.png"] forState:UIControlStateNormal];
//                [editBtn addTarget:self action:@selector(editPet:) forControlEvents:UIControlEventTouchUpInside];
//                editBtn.tag = 90 + i ;
//                [petInfoImg addSubview:editBtn];
//                
//                UIImageView *petImg = [[UIImageView alloc] initWithFrame:CGRectMake( 32.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height,116.0/640.0*frame.size.width, 116.0/1136.0*frame.size.height)];
//                [petImg setImage:[UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:[[self.petsArr objectAtIndex:i] objectForKey:@"portrait"]]]]];
//                petImg.layer.cornerRadius = petImg.bounds.size.width/2;
//                [petImg.layer setBorderWidth:2];
//                [petImg.layer setBorderColor:[[UIColor grayColor] CGColor]];
//                petImg.layer.masksToBounds = YES;
//                [petInfoImg addSubview:petImg];
//                
//                UILabel *pNameLbl = [[UILabel alloc] initWithFrame:CGRectMake( 157.0/640.0*frame.size.width, 37.0/1136.0*frame.size.height, 60.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height)];
//                pNameLbl.text = [[self.petsArr objectAtIndex:i] objectForKey:@"name"];
//                pNameLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
//                pNameLbl.textColor = [UIColor colorWithRed:118.0/255.0 green:196.0/255.0 blue:255.0/255.0 alpha:1.0];
//                [petInfoImg addSubview:pNameLbl];
//                
//                UILabel *pVarietiesLbl = [[UILabel alloc] initWithFrame:CGRectMake( 160.0/640.0*frame.size.width, 77.0/1136.0*frame.size.height, 48.0/640.0*frame.size.width, 26.0/1136.0*frame.size.height)];
//                pVarietiesLbl.text = [[self.petsArr objectAtIndex:i] objectForKey:@"breed"];
//                pVarietiesLbl.font = [UIFont fontWithName:@"Arial" size:12.0];
//                pVarietiesLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
//                [petInfoImg addSubview:pVarietiesLbl];
//                
//                UILabel *birthLbl = [[UILabel alloc] initWithFrame:CGRectMake( 158.0/640.0*frame.size.width, 111.0/1136.0*frame.size.height, 120.0/640.0*frame.size.width, 20.0/1136.0*frame.size.height)];
//                birthLbl.text = [[self.petsArr objectAtIndex:i] objectForKey:@"birthday"];
//                birthLbl.font = [UIFont fontWithName:@"Arial" size:12.0];
//                birthLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
//                [petInfoImg addSubview:birthLbl];
//                
//                UIImageView *postImg = [[UIImageView alloc] initWithFrame:CGRectMake( 252.0/640.0*frame.size.width, 98.0/1136.0*frame.size.height, 94.0/640.0*frame.size.width, 66.0/1136.0*frame.size.height)];
//                [postImg setImage:[UIImage imageNamed:@"postmark.png"]];
//                [petInfoImg addSubview:postImg];
//                
//                [petInfoImg release];
//                [petImg release];
//                [pNameLbl release];
//                [pVarietiesLbl release];
//                [birthLbl release];
//                [postImg release];
//                
//            }else if (i == [[self.userInfoDic objectForKey:@"pets"] count]+1){
//                
//                UIButton *addBtn = [UIButton buttonWithType:UIButtonTypeSystem];
//                addBtn.frame = CGRectMake(364.0/640.0*self.frame.size.width*[self.petsArr count], 78.0/1136.0*self.frame.size.height, 54.0/640.0*self.frame.size.width,54.0/1136.0*self.frame.size.height);
//                [addBtn setBackgroundImage:[UIImage imageNamed:@"add.png"] forState:UIControlStateNormal];
//                [addBtn addTarget:self action:@selector(addPet:) forControlEvents:UIControlEventTouchUpInside];
//                addBtn.tag = 20 + i ;
//                [self.sv addSubview:addBtn];
//                
//            }
//            
//        }
//        
//        [background release];
//        
//        UITableView *table = [[UITableView alloc] initWithFrame:CGRectMake(0, 668.0/1136.0*frame.size.height, frame.size.width, frame.size.height-668.0/1136.0*frame.size.height) style:UITableViewStylePlain];//-90.0/1136.0*self.frame.size.height
//        table.dataSource = self;
//        table.delegate = self;
//        table.bounces = NO;
//        //        table.separatorStyle = UITableViewCellSeparatorStyleNone;
//        [self addSubview:table];
//        
//        [table release];
        
        

    }
    return self;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return 7;
}

- (BOOL)tableView:(UITableView *)tableView canEditRowAtIndexPath:(NSIndexPath *)indexPath
{
    return NO;
}

-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    return 90.0/1136.0*self.frame.size.height;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    NSArray *array = [NSArray arrayWithObjects:@"帖子",@"粉丝",@"关注",@"相册",@"收藏",@"设置", nil];
    static NSString *CellIdentifier = @"CellIdentifier";
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
    if (!cell) {
//        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier];
        cell = [[UITableViewCell alloc] init];
        //        cell.accessoryType = UITableViewCellAccessoryDisclosureIndicator;
        cell.showsReorderControl = YES;
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
     
        
    
    
        if (indexPath.row == 0) {
            
            UIImageView *postImg = [[UIImageView alloc] initWithFrame:CGRectMake( 32.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 34.0/640.0*self.frame.size.width, 42.0/1136.0*self.frame.size.height)];
            [postImg setImage:[UIImage imageNamed:@"post_icon.png"]];
            [cell.contentView addSubview:postImg];
            
            UILabel *numLbl = [[UILabel alloc] initWithFrame:CGRectMake( 480.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 100.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            numLbl.text = [self.userInfoDic objectForKey:@"postNum"];
            numLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
            numLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
            numLbl.textAlignment = NSTextAlignmentRight;
            [cell.contentView addSubview:numLbl];
            
            UILabel *secLbl = [[UILabel alloc] initWithFrame:CGRectMake( 86.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 80.0/640.0*self.frame.size.width, 40.0/1136.0*self.frame.size.height)];
            secLbl.text = [array objectAtIndex:0];
            secLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:16.0];
            secLbl.textColor = [UIColor colorWithRed:70.0/255.0 green:70.0/255.0 blue:70.0/255.0 alpha:1.0];
            secLbl.textAlignment = NSTextAlignmentCenter;
            [cell.contentView addSubview:secLbl];
            
            UIImageView *arrowImg = [[UIImageView alloc] initWithFrame:CGRectMake( 604.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 16.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            [arrowImg setImage:[UIImage imageNamed:@"right_arrow.png"]];
            [cell.contentView addSubview:arrowImg];
            [arrowImg release];
            
        }else if(indexPath.row == 1){
            
            UIImageView *fansImg = [[UIImageView alloc] initWithFrame:CGRectMake( 28.0/640.0*self.frame.size.width, 23.0/1136.0*self.frame.size.height, 44.0/640.0*self.frame.size.width, 42.0/1136.0*self.frame.size.height)];
            [fansImg setImage:[UIImage imageNamed:@"fans.png"]];
            [cell.contentView addSubview:fansImg];
            
            UILabel *numLbl = [[UILabel alloc] initWithFrame:CGRectMake( 480.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 100.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            numLbl.text = [self.userInfoDic objectForKey:@"fans"];
            numLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
            numLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
            numLbl.textAlignment = NSTextAlignmentRight;
            [cell.contentView addSubview:numLbl];
            
            UILabel *secLbl = [[UILabel alloc] initWithFrame:CGRectMake( 86.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 80.0/640.0*self.frame.size.width, 40.0/1136.0*self.frame.size.height)];
            secLbl.text = [array objectAtIndex:1];
            secLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:16.0];
            secLbl.textColor = [UIColor colorWithRed:70.0/255.0 green:70.0/255.0 blue:70.0/255.0 alpha:1.0];
            secLbl.textAlignment = NSTextAlignmentCenter;
            [cell.contentView addSubview:secLbl];
            
            UIImageView *arrowImg = [[UIImageView alloc] initWithFrame:CGRectMake( 604.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 16.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            [arrowImg setImage:[UIImage imageNamed:@"right_arrow.png"]];
            [cell.contentView addSubview:arrowImg];
            [arrowImg release];
            
        }else if(indexPath.row == 2){
            
            UIImageView *attImg = [[UIImageView alloc] initWithFrame:CGRectMake( 24.0/640.0*self.frame.size.width, 30.0/1136.0*self.frame.size.height, 50.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height)];
            [attImg setImage:[UIImage imageNamed:@"attention.png"]];
            [cell.contentView addSubview:attImg];
            
            UILabel *numLbl = [[UILabel alloc] initWithFrame:CGRectMake( 480.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 100.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            numLbl.text = [self.userInfoDic objectForKey:@"focus"];
            numLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
            numLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
            numLbl.textAlignment = NSTextAlignmentRight;
            [cell.contentView addSubview:numLbl];
            
            UILabel *secLbl = [[UILabel alloc] initWithFrame:CGRectMake( 86.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 80.0/640.0*self.frame.size.width, 40.0/1136.0*self.frame.size.height)];
            secLbl.text = [array objectAtIndex:2];
            secLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:16.0];
            secLbl.textColor = [UIColor colorWithRed:70.0/255.0 green:70.0/255.0 blue:70.0/255.0 alpha:1.0];
            secLbl.textAlignment = NSTextAlignmentCenter;
            [cell.contentView addSubview:secLbl];
            
            UIImageView *arrowImg = [[UIImageView alloc] initWithFrame:CGRectMake( 604.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 16.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            [arrowImg setImage:[UIImage imageNamed:@"right_arrow.png"]];
            [cell.contentView addSubview:arrowImg];
            [arrowImg release];
            
        }else if(indexPath.row == 3){
            
            UIImageView *fotoImg = [[UIImageView alloc] initWithFrame:CGRectMake( 29.0/640.0*self.frame.size.width, 31.0/1136.0*self.frame.size.height, 42.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height)];
            [fotoImg setImage:[UIImage imageNamed:@"photoicon.png"]];
            [cell.contentView addSubview:fotoImg];
            
            UILabel *secLbl = [[UILabel alloc] initWithFrame:CGRectMake( 86.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 80.0/640.0*self.frame.size.width, 40.0/1136.0*self.frame.size.height)];
            secLbl.text = [array objectAtIndex:3];
            secLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:16.0];
            secLbl.textColor = [UIColor colorWithRed:70.0/255.0 green:70.0/255.0 blue:70.0/255.0 alpha:1.0];
            secLbl.textAlignment = NSTextAlignmentCenter;
            [cell.contentView addSubview:secLbl];
            
            UIImageView *arrowImg = [[UIImageView alloc] initWithFrame:CGRectMake( 604.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 16.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            [arrowImg setImage:[UIImage imageNamed:@"right_arrow.png"]];
            [cell.contentView addSubview:arrowImg];
            [arrowImg release];
            
        }else if(indexPath.row == 4){
            
            UIImageView *colImg = [[UIImageView alloc] initWithFrame:CGRectMake( 28.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 44.0/640.0*self.frame.size.width, 44.0/1136.0*self.frame.size.height)];
            [colImg setImage:[UIImage imageNamed:@"collection.png"]];
            [cell.contentView addSubview:colImg];
            
            UILabel *numLbl = [[UILabel alloc] initWithFrame:CGRectMake( 480.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 100.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            numLbl.text = [self.userInfoDic objectForKey:@"collectNum"];
            numLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:14.0];
            numLbl.textColor = [UIColor colorWithRed:140.0/255.0 green:140.0/255.0 blue:140.0/255.0 alpha:1.0];
            numLbl.textAlignment = NSTextAlignmentRight;
            [cell.contentView addSubview:numLbl];
            UILabel *secLbl = [[UILabel alloc] initWithFrame:CGRectMake( 86.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 80.0/640.0*self.frame.size.width, 40.0/1136.0*self.frame.size.height)];
            secLbl.text = [array objectAtIndex:4];
            secLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:16.0];
            secLbl.textColor = [UIColor colorWithRed:70.0/255.0 green:70.0/255.0 blue:70.0/255.0 alpha:1.0];
            secLbl.textAlignment = NSTextAlignmentCenter;
            [cell.contentView addSubview:secLbl];
            
            UIImageView *arrowImg = [[UIImageView alloc] initWithFrame:CGRectMake( 604.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 16.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            [arrowImg setImage:[UIImage imageNamed:@"right_arrow.png"]];
            [cell.contentView addSubview:arrowImg];
            [arrowImg release];
            
        }else if(indexPath.row == 5){
            
            UIImageView *setImg = [[UIImageView alloc] initWithFrame:CGRectMake( 30.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 42.0/640.0*self.frame.size.width, 42.0/1136.0*self.frame.size.height)];
            [setImg setImage:[UIImage imageNamed:@"setting.png"]];
            [cell.contentView addSubview:setImg];
            
            UILabel *secLbl = [[UILabel alloc] initWithFrame:CGRectMake( 86.0/640.0*self.frame.size.width, 25.0/1136.0*self.frame.size.height, 80.0/640.0*self.frame.size.width, 40.0/1136.0*self.frame.size.height)];
            secLbl.text = [array objectAtIndex:5];
            secLbl.font = [UIFont fontWithName:@"Arial-BoldItalicMT" size:16.0];
            secLbl.textColor = [UIColor colorWithRed:70.0/255.0 green:70.0/255.0 blue:70.0/255.0 alpha:1.0];
            secLbl.textAlignment = NSTextAlignmentCenter;
            [cell.contentView addSubview:secLbl];
            
            UIImageView *arrowImg = [[UIImageView alloc] initWithFrame:CGRectMake( 604.0/640.0*self.frame.size.width, 32.0/1136.0*self.frame.size.height, 16.0/640.0*self.frame.size.width, 28.0/1136.0*self.frame.size.height)];
            [arrowImg setImage:[UIImage imageNamed:@"right_arrow.png"]];
            [cell.contentView addSubview:arrowImg];
            [arrowImg release];
            
        }else if(indexPath.row == 5){
            
        }
        
    }
    

    
    return cell;
    
}

-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    [[NSNotificationCenter defaultCenter] postNotificationName:@"SECTIONCHOOSE" object:[NSString stringWithFormat:@"%d",indexPath.row]];
}

-(void)handleLongPressGestures:(UILongPressGestureRecognizer *)paramSender{
    for (int i = 0; i < [[self.userInfoDic objectForKey:@"pets"] count]; i++) {
        UIButton *btn = (UIButton *)[self viewWithTag:20+i];
        [btn setHidden:NO];
    }
}

-(void)singleTap:(UILongPressGestureRecognizer *)paramSender{
    for (int i = 0; i < [[self.userInfoDic objectForKey:@"pets"] count]; i++) {
        UIButton *btn = (UIButton *)[self viewWithTag:20+i];
        [btn setHidden:YES];
    }
}

-(void)addPet:(UIButton *)btn
{
    [[NSNotificationCenter defaultCenter] postNotificationName:@"ADDPET" object:nil];
}


-(void)deletePet:(UIButton *)btn
{
    NSLog(@"delete，btn.tag:%d",btn.tag);
    
    DeletePet *dp = [[DeletePet alloc] init];
    [dp deletePet:[[[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-20] objectForKey:@"id"] intValue]];
    [dp release];
    
    
    
    [petsArr removeObjectAtIndex:btn.tag-20];
 
    for (UIView *view in self.sv.subviews) {
        if (view.tag == btn.tag-20) {
            [view removeFromSuperview];
        }
        if (view.tag > btn.tag-20) {
            view.frame = CGRectMake(view.frame.origin.x-364.0/640.0*self.frame.size.width, view.frame.origin.y, view.frame.size.width, view.frame.size.height);
        }
    }
    
    self.sv.contentSize = CGSizeMake(364.0/640.0*self.frame.size.width*([[self.userInfoDic objectForKey:@"pets"] count]-1)+114.0/640.0*self.frame.size.width, 170.0/1136.0*self.frame.size.height);
    
}

-(void)editPet:(UIButton *)btn
{
    NSLog(@"edit,btn.tag:%d",btn.tag);
    
//    editPet.portrait = [[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"portrait"];
//    editPet.petName = [[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"name"];
//    editPet.sexIndex = [[[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"sex"] intValue];
//    editPet.selectedRace = [[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"portrait"];
//    editPet.selectedBreed = [[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"breed"];
//    editPet.birthday = [[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"birthday"];
    
    NSMutableDictionary *dic = [NSMutableDictionary dictionaryWithCapacity:0];
    [dic setObject:[[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"portrait"] forKey:@"portrait"];
    [dic setObject:[[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"name"] forKey:@"name"];
    [dic setObject:[[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"sex"] forKey:@"sex"];
    [dic setObject:[[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"breed"] forKey:@"breed"];
    [dic setObject:[[[self.userInfoDic objectForKey:@"pets"] objectAtIndex:btn.tag-90] objectForKey:@"birthday"] forKey:@"birthday"];
    
    
    [[NSNotificationCenter defaultCenter] postNotificationName:@"EDITPET" object:dic];
}

-(void)dealloc
{
    [userInfoDic release];
    [sv release];
    [petsArr release];
    [super dealloc];
}

/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
